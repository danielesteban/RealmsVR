(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{0:function(e,t,n){n("55Il"),n("p2bk"),e.exports=n("7RL8")},1:function(e,t){},"7RL8":function(e,t,n){"use strict";n.r(t);var r=n("LhCv"),i=n("q1tI"),a=n.n(i),o=n("i8i4"),s=n("ANjH"),c=n("Igns"),u=n("/MKj"),l=n("gyEF"),f=n.n(l),p=n("Ty5D"),h=n("sINF"),y=n("N2Rb"),d="REALM/FETCH_FULFILLED",b="REALM/UPDATE_GEOMETRY",m="REALM/UPDATE_VOXELS",v="REALM/RESET",g="USER/REFRESH_SESSION_FULFILLED",w="USER/REFRESH_SESSION_REJECTED",O="USER/SIGNOUT";function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseURL="https://projects.gatunes.com/realmsvr/"}var t,n,r;return t=e,(n=[{key:"fetch",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t=e.body,n=e.endpoint,r=e.headers,o=void 0===r?{}:r,i=e.method,a=void 0===i?"GET":i,s=this.authorization,c=this.baseURL;return s&&(o.Authorization=s),!t||t instanceof FormData||(t=JSON.stringify(t),o["Content-Type"]="application/json"),fetch("".concat(c).concat(n),{body:t,headers:o,method:a}).then(function(e){var t=e.headers,n=e.status;if(n<200||400<=n)throw new Error(n);switch((t.get("Content-Type")||"").split(";")[0]){case"text/plain":return e.arrayBuffer();case"application/json":return e.json();default:return e}})})},{key:"setAuthorization",value:function(e){e?this.authorization="Bearer ".concat(e):delete this.authorization,this.token=e}}])&&S(t.prototype,n),r&&S(t,r),e}());function x(e){return e?{type:g,payload:e}:function(e){return e({type:"USER/REFRESH_SESSION",payload:E.fetch({endpoint:"user"})}).catch(function(){})}}n("bo1M");var j=n("wcCE");var _={en:{NotFound:{description:"This is not the web page you're looking for.",goBack:"Take me back home"},User:{signIn:"Sign-In",signOut:"Sign-Out"}},es:{NotFound:{description:"Esta no es la página que estás buscando.",goBack:"Volver al inicio"},User:{signIn:"Iniciar sesión",signOut:"Cerrar sesión"}}},R=Object.keys(_),P="en",k={};R.forEach(function(e){k[e]=Object(j.recursive)(!0,_.en,_[e])});var M=Object(s.c)({realms:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length?arguments[1]:void 0;switch(t.type){case"LOBBY/FETCH_REALMS_FULFILLED":return t.payload;default:return e}}}),T=Object(s.c)({geometry:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;switch(t.type){case"REALM/UPDATE_GEOMETRY_FULFILLED":return t.payload;case v:return{};default:return e}},id:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length?arguments[1]:void 0;switch(t.type){case d:return t.payload._id;case v:return"";default:return e}},name:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length?arguments[1]:void 0;switch(t.type){case d:return t.payload.name;case v:return"";default:return e}},size:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length?arguments[1]:void 0;switch(t.type){case d:return t.payload.size;case v:return 0;default:return e}},voxels:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Uint32Array,t=1<arguments.length?arguments[1]:void 0;switch(t.type){case d:case m:return t.payload.voxels;case v:return new Uint32Array;default:return e}}}),A="REALMSVR::SESSION",C=JSON.parse(localStorage.getItem(A)||"false");C&&E.setAuthorization(C.token);var D=Object(s.c)({isAuth:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!!C;switch((1<arguments.length?arguments[1]:void 0).type){case g:return!0;case w:case O:return!1;default:return e}},profile:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:C?C.profile:{},t=1<arguments.length?arguments[1]:void 0;switch(t.type){case g:return t.payload.profile;case w:case O:return{};default:return e}},token:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:C?C.token:{},t=1<arguments.length?arguments[1]:void 0;switch(t.type){case g:return E.setAuthorization(t.payload.token),localStorage.setItem(A,JSON.stringify(t.payload)),t.payload.token;case w:case O:return E.setAuthorization(!1),localStorage.removeItem(A),"";default:return e}}}),L=Object(s.c)({i18n:y.i18nReducer,loadingBar:l.loadingBarReducer,lobby:M,realm:T,user:D}),U=n("vOnD"),I=n("Womt");function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var W=function(e){function i(){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),i.mesh&&i.pointerMesh||i.setup(),n=q(this,B(i).call(this));for(var r=i.mesh,o=i.pointerMesh,e=function(e){var t=r.clone();t.buttons={menu:!1,menuDown:!1,menuUp:!1,grip:!1,gripDown:!1,gripUp:!1,pad:!1,padDown:!1,padUp:!1,trigger:!1,triggerDown:!1,triggerUp:!1},t.pointer=o.clone(),t.pointer.visible=!1,t.add(t.pointer),t.matrixAutoUpdate=!1,t.setupRaycaster=function(e){return i.setupRaycaster({hand:t,raycaster:e})},t.visible=!1,n.add(t)},t=0;t<2;t+=1)e();return n}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(i,I["m"]),t=i,r=[{key:"setupRaycaster",value:function(e){var t=e.hand,n=e.raycaster;t.auxMatrix||(t.auxMatrix=new I.j);var r=t.auxMatrix,o=t.matrixWorld;r.identity().extractRotation(o),n.ray.origin.setFromMatrixPosition(o),n.ray.direction.set(0,0,-1).applyMatrix4(r),n.ray.origin.addScaledVector(n.ray.direction,-.175)}},{key:"setup",value:function(){if(!i.geometry){var e=new I.a(1,1,1);e.scale(.05,.03,.2),e.translate(0,0,.075),e.faces.forEach(function(e,t){e.color.set(7829367),10<=t&&t<=11&&e.color.offsetHSL(0,0,-.1)}),i.geometry=(new I.c).fromGeometry(e)}i.material||(i.material=new I.l({color:16769213})),i.mesh||(i.mesh=new I.k(i.geometry,i.material)),i.pointerGeometry||(i.pointerGeometry=(new I.c).setFromPoints([new I.t(0,0,0),new I.t(0,0,-1)])),i.pointerMaterial||(i.pointerMaterial=new I.i({color:16769213})),i.pointerMesh||(i.pointerMesh=new I.h(i.pointerGeometry,i.pointerMaterial))}}],(n=[{key:"update",value:function(){var e=this.children,t="getGamepads"in navigator?navigator.getGamepads():[];e.forEach(function(e){e.visible=!1});for(var n=0,r=0;r<t.length;r+=1){var o=t[r];if(o&&("OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("Spatial Controller"))&&(o.pose&&this.updateHand({hand:e[n],buttons:o.buttons,pose:o.pose}),1<(n+=1)))break}}},{key:"updateHand",value:function(e){var t=e.hand,n=e.buttons,r=e.pose,o=this.standingMatrix;null!==r.position&&t.position.fromArray(r.position),null!==r.orientation&&t.quaternion.fromArray(r.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(o),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var i=n[3]&&n[3].pressed;t.buttons.menuDown=i&&t.buttons.menu!==i,t.buttons.menuUp=!i&&t.buttons.menu!==i,t.buttons.menu=i;var a=n[2]&&n[2].pressed;t.buttons.gripDown=a&&t.buttons.grip!==a,t.buttons.gripUp=!a&&t.buttons.grip!==a,t.buttons.grip=a;var s=n[0]&&n[0].pressed;t.buttons.padDown=s&&t.buttons.pad!==s,t.buttons.padUp=!s&&t.buttons.pad!==s,t.buttons.pad=s;var c=n[1]&&n[1].pressed;t.buttons.triggerDown=c&&t.buttons.trigger!==c,t.buttons.triggerUp=!c&&t.buttons.trigger!==c,t.buttons.trigger=c}}])&&F(t.prototype,n),r&&F(t,r),i}();function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Z=function(e){function o(e){var t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n=this,(t=!(r=Y(o).call(this,e))||"object"!==H(r)&&"function"!=typeof r?X(n):r).canvas=a.a.createRef(),t.onAnimationTick=t.onAnimationTick.bind(X(t)),t.onResize=t.onResize.bind(X(t)),t}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(o,i["Component"]),t=o,(n=[{key:"componentDidMount",value:function(){var e=this.canvas.current;this.camera=new I.n(90,1,.1,1024),this.clock=new I.e,this.raycaster=new I.q,this.raycaster.far=32,this.room=new I.m,this.room.add(this.camera),this.hands=new W,this.room.add(this.hands),this.resetCamera(),this.resetScene();var t=new I.v({antialias:!0,canvas:e,powerPreference:"high-performance",stencil:!1});t.setPixelRatio(window.devicePixelRatio||1),t.setClearColor(this.scene.fog.color),t.setAnimationLoop(this.onAnimationTick),window.addEventListener("resize",this.onResize,!1),this.renderer=t,this.onResize(),this.setupVR()}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"onAnimationTick",value:function(){var e=this.camera,t=this.clock,n=this.hands,r=this.renderer,o=this.scene;r.animation={delta:t.getDelta(),time:t.oldTime/1e3},n.update(),r.render(o,e)}},{key:"onResize",value:function(){var e=this.canvas.current,t=this.camera,n=this.renderer,r=e.parentNode.getBoundingClientRect(),o=r.width,i=r.height;this.width=o,this.height=i,n.vr.isPresenting()||n.setSize(o,i),t.aspect=o/i,t.updateProjectionMatrix()}},{key:"getMaxAnisotropy",value:function(){return this.renderer.capabilities.getMaxAnisotropy()}},{key:"setupVR",value:function(){var e=this.hands,n=this.renderer,t="xr"in navigator,r="getVRDisplays"in navigator;if(t){var o=function(){if(!n.vr.isPresenting()){var e=n.vr.getDevice();e?e.requestSession({immersive:!0,exclusive:!0}).then(function(e){n.vr.setSession(e,{frameOfReferenceType:"stage"})}):navigator.xr.requestDevice().then(function(e){n.vr.enabled=!0,n.vr.setDevice(e)})}};window.addEventListener("mousedown",o,!1),o()}else if(r){var i=function(){if(!n.vr.isPresenting()){var e=n.vr.getDevice();e?e.requestPresent([{source:n.domElement}]):navigator.getVRDisplays().then(function(e){if(e.length){var t=N(e,1)[0];n.vr.enabled=!0,n.vr.setDevice(t)}})}};window.addEventListener("mousedown",i,!1),window.addEventListener("vrdisplayactivate",i,!1),i()}e.standingMatrix=n.vr.getStandingMatrix()}},{key:"resetCamera",value:function(){var e=this.camera;e.position.set(0,1.6,0),e.rotation.set(0,0,0)}},{key:"resetScene",value:function(){return this.room.position.set(0,0,0),this.scene=new I.r,this.scene.add(this.room),this.scene.fog=new I.g(0,.015),this.scene.fog.color.setRGB(0,0,.1),this.scene}},{key:"render",value:function(){var e=this.canvas;return a.a.createElement("canvas",{ref:e})}}])&&V(t.prototype,n),r&&V(t,r),o}();I.s.fog_pars_vertex=I.s.fog_pars_vertex.replace("varying float fogDepth;","varying vec4 fogDepth;"),I.s.fog_vertex=I.s.fog_vertex.replace("fogDepth = -mvPosition.z;","fogDepth = mvPosition;"),I.s.fog_pars_fragment=I.s.fog_pars_fragment.replace("varying float fogDepth;","varying vec4 fogDepth;"),I.s.fog_fragment=I.s.fog_fragment.replace("float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );",["float fogDist = length(fogDepth);","float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDist * fogDist * LOG2 ) );"].join("\n")).replace("float fogFactor = smoothstep( fogNear, fogFar, fogDepth );","float fogFactor = smoothstep( fogNear, fogFar, length(fogDepth) );");var K=Z,Q=n("17x9"),$=n.n(Q),ee=n("O1PE");function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ae=U.a.div.withConfig({displayName:"session__Wrapper",componentId:"sc-1avroa0-0"})(["position:fixed;top:0;right:0;> button{display:flex;align-items:center;outline:0;font-family:inherit;font-size:1.2rem;font-weight:700;width:150px;padding:0.5rem 1rem;> svg{margin-right:0.5rem;}}"]),se=function(e){function o(e){var t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n=this,(t=!(r=re(o).call(this,e))||"object"!==te(r)&&"function"!=typeof r?oe(n):r).loginWithGoogle=t.loginWithGoogle.bind(oe(t)),t.onMessage=t.onMessage.bind(oe(t)),t}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(o,i["PureComponent"]),t=o,(n=[{key:"componentWillUnmount",value:function(){var e=this.popupWatcher;e&&(window.removeEventListener("message",this.onMessage),clearInterval(e),delete this.popupWatcher)}},{key:"onMessage",value:function(e){var t=e.origin,n=e.data.session,r=this.popupWatcher,o=this.props.refreshSession;0===E.baseURL.indexOf(t)&&(window.removeEventListener("message",this.onMessage),clearInterval(r),delete this.popupWatcher,n&&o(n))}},{key:"loginWithGoogle",value:function(e){var t=this,n=e.screenX,r=e.screenY,o=(n||window.screen.width/2)-512,i=r||window.screen.height/2,a=window.open("".concat(E.baseURL,"user/google"),"loginWithGoogle","width=".concat(512,",height=").concat(512,",top=").concat(i,",left=").concat(o));this.popupWatcher&&(window.removeEventListener("message",this.onMessage),clearInterval(this.popupWatcher)),this.popupWatcher=setInterval(function(){if(!a.window)return clearInterval(t.popupWatcher),void delete t.popupWatcher;a.postMessage(!0,E.baseURL)},100),window.addEventListener("message",this.onMessage,!1)}},{key:"render",value:function(){var e=this.props,t=e.isAuth,n=e.signout;return a.a.createElement(ae,null,t?a.a.createElement("button",{type:"button",onClick:n},a.a.createElement(ee.TiEject,null),a.a.createElement(y.Translate,{value:"User.signOut"})):a.a.createElement("button",{type:"button",onClick:this.loginWithGoogle},a.a.createElement(ee.TiSocialGooglePlus,null),a.a.createElement(y.Translate,{value:"User.signIn"})))}}])&&ne(t.prototype,n),r&&ne(t,r),o}();se.propTypes={isAuth:$.a.bool.isRequired,refreshSession:$.a.func.isRequired,signout:$.a.func.isRequired};var ce=Object(u.connect)(function(e){return{isAuth:e.user.isAuth}},{refreshSession:x,signout:function(){return{type:O}}})(se),ue=n("1339"),le=n.n(ue);function fe(e){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){return!t||"object"!==fe(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var de=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=new I.p(256,256,256,256);e.rotateX(-.5*Math.PI);var n=new I.f;return e.faces.forEach(function(e,t){t%2==1?e.color.copy(n):(e.color.setHex(5592405),e.color.offsetHSL(0,0,-.1*Math.random()),n.copy(e.color))}),pe(this,he(t).call(this,(new I.c).fromGeometry(e),new I.l({vertexColors:I.u})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(t,I["k"]),t}();function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function me(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Oe=function(e){function a(e){var t,n=e.anisotropy;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var r=document.createElement("canvas");r.width=512,r.height=512;var o=new I.d(r);o.anisotropy=n,t=me(this,ge(a).call(this,new I.o(1,1),new I.l({map:o})));var i=new I.k(new I.o(1,1),new I.l({color:1118481}));return i.geometry.rotateY(Math.PI),t.add(i),t.context=r.getContext("2d"),t.pointer=new I.t,t.renderer=r,t.texture=o,t}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(a,I["k"]),t=a,(n=[{key:"draw",value:function(){var e=this.context,t=this.renderer,n=this.texture;e.fillStyle="#111",e.fillRect(0,0,t.width,t.height),n.needsUpdate=!0}},{key:"onPointer",value:function(e){var t=this.pointer,n=this.renderer;this.worldToLocal(t.copy(e)),t.set((t.x+.5)*n.width,(1-(t.y+.5))*n.height,0)}}])&&ve(t.prototype,n),r&&ve(t,r),a}();function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function je(e,t,n){return t&&xe(e.prototype,t),n&&xe(e,n),e}function _e(e,t){return!t||"object"!==Se(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Re(e,t,n){return(Re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pe(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Te=function(e){function i(e){var t,n=e.anisotropy,r=e.name,o=e.onPointer;return Ee(this,i),(t=_e(this,Pe(i).call(this,{anisotropy:n}))).scale.set(.25,.25,1),t.name=r,t.onPointer=o,t.draw(),t}return ke(i,Oe),je(i,[{key:"draw",value:function(){var e=this.context,t=this.isHover,n=this.name,r=this.renderer;Re(Pe(i.prototype),"draw",this).call(this),e.fillStyle=t?"#333":"#111",e.fillRect(0,0,r.width,r.height),e.font="80px Roboto",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#fff",e.fillText(n,.5*r.width,.5*r.height)}}]),i}(),Ae=function(e){function o(e){var t,n=e.anisotropy,r=e.history;return Ee(this,o),(t=_e(this,Pe(o).call(this))).anisotropy=n,t.history=r,t.hover={},t.position.set(0,1.25,-1),t}return ke(o,I["m"]),je(o,[{key:"setHover",value:function(e){var t=e.hand,n=e.realm,r=this.hover;r[t]&&(r[t].isHover=!1,r[t].draw()),n&&(n.isHover=!0,n.draw()),this.hover[t]=n}},{key:"update",value:function(e){for(var i=this,t=this.anisotropy,n=this.children,a=this.history;n.length;)this.remove(n[0]);var s=.25+-.25*e.length;e.forEach(function(r,e){var o=new Te(function(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},t=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){var t,n,r;t=o,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r})}return o}({},r,{anisotropy:t,onPointer:function(e){var t=e.hand,n=e.isDown;i.setHover({hand:t,realm:o}),n&&a.push("/".concat(r.slug))}}));o.position.set(s+.5*e,0,0),o.lookAt(0,.5,1),i.add(o)})}}]),o}();function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ze=function(e){function i(e){var t,n=e.anisotropy;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var r=document.createElement("canvas");r.width=1024,r.height=1024;var o=new I.d(r);return o.anisotropy=n,(t=Le(this,Ue(i).call(this,new I.o(2,2),new I.l({map:o,transparent:!0})))).lookAt(0,-.25,1),t.position.set(0,2,-3),t.renderer=r,t.texture=o,setTimeout(function(){return t.draw()},250),t}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(i,I["k"]),t=i,(n=[{key:"draw",value:function(){var e=this.renderer,t=this.texture,n=e.getContext("2d"),r=n.createLinearGradient(0,0,0,e.height);r.addColorStop(0,"rgba(0,0,0,0.25)"),r.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=r,n.fillRect(0,0,e.width,e.height),n.font="700 200px Roboto",n.textAlign="center",n.textBaseline="middle",n.fillStyle="#eee",n.fillText("RealmsVR",.5*e.width,.2*e.height),n.font="60px Roboto",n.fillStyle="#999",n.fillText("A recursive VR experience",.5*e.width,.5*e.height),n.font="60px Roboto",n.fillStyle="#bbb",n.fillText("dani@gatunes © 2019",.5*e.width,.8*e.height),t.needsUpdate=!0}}])&&De(t.prototype,n),r&&De(t,r),i}();function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ge(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ge(this,We(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}(t,i["PureComponent"]),n=t,(r=[{key:"componentDidMount",value:function(){var e=this.props,t=e.history,n=e.renderer.current,r=e.fetchRealms,o=n.getMaxAnisotropy(),i=n.resetScene();i.add(new de),i.add(new ze({anisotropy:o})),this.menu=new Ae({anisotropy:o,history:t}),i.add(this.menu),this.renderer=n,(this.scene=i).onBeforeRender=this.onBeforeRender.bind(this),r({page:0}),n.renderer.vr.enabled||(this.touches=le()(window,{filtered:!0,target:n.canvas.current}).on("start",this.onPointerDown.bind(this)))}},{key:"componentDidUpdate",value:function(e){var t=e.realms,n=this.props.realms;n!==t&&this.menu.update(n)}},{key:"componentWillUnmount",value:function(){var e=this.scene,t=this.touches;delete e.onBeforeRender,t&&t.disable()}},{key:"onBeforeRender",value:function(){var s=this.menu,e=this.renderer,t=e.hands,c=e.raycaster;t.children.forEach(function(e,t){var n=e.buttons,r=e.pointer;e.setupRaycaster(c);var o=c.intersectObjects(s.children)[0]||!1;if(!o)return r.visible=!1,void s.setHover({hand:t});var i=o.distance,a=o.object;r.scale.z=i-.175,r.visible=!0,a.onPointer({hand:t,isDown:n.triggerDown})})}},{key:"onPointerDown",value:function(e,t){var n=qe(t,2),r=n[0],o=n[1],i=this.menu,a=this.renderer,s=a.camera,c=a.raycaster,u=a.width,l=a.height;c.setFromCamera({x:-2*Math.min(Math.max(.5-r/u,-.5),.5),y:2*Math.min(Math.max(.5-o/l,-.5),.5)},s);var f=c.intersectObjects(i.children)[0]||!1;f&&f.object.onPointer({hand:0,isDown:!0})}},{key:"render",value:function(){return null}}])&&Be(n.prototype,r),o&&Be(n,o),t}();Ne.propTypes={history:$.a.object.isRequired,realms:$.a.arrayOf($.a.shape({name:$.a.string.isRequired,slug:$.a.string.isRequired})).isRequired,renderer:$.a.shape({current:$.a.instanceOf(K)}).isRequired,fetchRealms:$.a.func.isRequired};var Ve=Object(u.connect)(function(e){return{realms:e.lobby.realms}},{fetchRealms:function(e){var t=e.page,n=void 0===t?0:t;return{type:"LOBBY/FETCH_REALMS",payload:E.fetch({endpoint:"realms/".concat(n)})}}})(Ne),Ye=n("f7Ve"),Xe=n.n(Ye);function Je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ze=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.promiseId=0,this.promises={},this.worker=new Xe.a,this.worker.onmessage=this.onMessage.bind(this)}var t,n,r;return t=e,(n=[{key:"generate",value:function(e){var t=this,n=e.size,r=e.voxels,o=this.promiseId,i=this.promises,a=this.worker;return new Promise(function(e){i[o]=e,t.promiseId+=1,a.postMessage({promiseId:o,size:n,voxels:r})})}},{key:"onMessage",value:function(e){var t=e.data,n=t.geometry,r=t.promiseId,o=this.promises;o[r](n),delete o[r]}}])&&Je(t.prototype,n),r&&Je(t,r),e}());function Ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Qe(e){var t=e.size,n=e.voxels;return{type:b,payload:Ze.generate({size:t,voxels:n})}}function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nt(e,t,n){return(nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=rt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function rt(e){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var it=function(e){function g(e){var t,n,r,o=e.anisotropy;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),n=this;var i=tt(t=!(r=rt(g).call(this,{anisotropy:o}))||"object"!==$e(r)&&"function"!=typeof r?tt(n):r).renderer;return t.position.set(-.15,.15,.075),t.rotation.set(0,.5*Math.PI,.1*Math.PI,"ZYX"),t.scale.set(.3,.3,1),t.block={x:.05*i.width,y:.05*i.height,width:.75*i.width,height:.75*i.height},t.strip={x:.85*i.width,y:.05*i.height,width:.1*i.width,height:.75*i.height},t.blockColor=new I.f,t.color=new I.f,t.blockColor.setRGB(1,0,0),t.color.copy(t.blockColor),t.draw(),t}var t,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(g,Oe),t=g,(n=[{key:"draw",value:function(){var e=this.block,t=this.blockColor,n=this.color,r=this.context,o=this.renderer,i=this.strip;nt(rt(g.prototype),"draw",this).call(this);var a=e.x,s=e.y,c=e.width,u=e.height;r.save(),r.translate(a,s),r.fillStyle="#".concat(t.getHexString()),r.fillRect(0,0,c,u);var l=r.createLinearGradient(0,0,c,0);l.addColorStop(0,"rgba(255,255,255,1)"),l.addColorStop(1,"rgba(255,255,255,0)"),r.fillStyle=l,r.fillRect(0,0,c,u);var f=r.createLinearGradient(0,0,0,u);f.addColorStop(0,"rgba(0,0,0,0)"),f.addColorStop(1,"rgba(0,0,0,1)"),r.fillStyle=f,r.fillRect(0,0,c,u),r.restore();var p=i.x,h=i.y,y=i.width,d=i.height;r.save(),r.translate(p,h);var b=r.createLinearGradient(0,0,0,d);b.addColorStop(0,"rgba(255, 0, 0, 1)"),b.addColorStop(.17,"rgba(255, 255, 0, 1)"),b.addColorStop(.34,"rgba(0, 255, 0, 1)"),b.addColorStop(.51,"rgba(0, 255, 255, 1)"),b.addColorStop(.68,"rgba(0, 0, 255, 1)"),b.addColorStop(.85,"rgba(255, 0, 255, 1)"),b.addColorStop(1,"rgba(255, 0, 0, 1)"),r.fillStyle=b,r.fillRect(0,0,y,d),r.restore(),r.save();var v=.3*o.width,m=.1*o.width;r.translate(.35*o.width,.85*o.height),r.rect(0,0,v,m),r.fillStyle="#".concat(n.getHexString()),r.fillRect(0,0,v,m),r.restore()}},{key:"onPointer",value:function(e){var c=this,t=this.block,u=this.blockColor,l=this.color,f=this.context,p=this.pointer,n=this.strip;nt(rt(g.prototype),"onPointer",this).call(this,e),[t,n].forEach(function(e,t){var n=e.x,r=e.y,o=e.width,i=e.height;if(!(p.x<n||p.x>n+o||p.y<r||p.y>r+i)){var a=1===t,s=f.getImageData(p.x,p.y,1,1).data;a&&u.setRGB(s[0]/255,s[1]/255,s[2]/255),l.setRGB(s[0]/255,s[1]/255,s[2]/255),c.draw()}})}}])&&et(t.prototype,n),r&&et(t,r),g}();function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function st(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ct(e,t){return!t||"object"!==at(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function ut(e){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lt(e,t){return(lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ft=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ct(this,ut(t).call(this))).geometry=new I.c,e.material=new I.l({vertexColors:I.u}),e.visible=!1,e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lt(e,t)}(t,I["m"]),n=t,(r=[{key:"resize",value:function(e){for(var t=this.children,n=this.geometry,r=this.material;t.length;)this.remove(t[0]);for(var o=-8;o<=8;o+=1)for(var i=-8;i<=8;i+=1)for(var a=-8;a<=8;a+=1){var s=new I.k(n,r);s.matrixAutoUpdate=!1,s.position.set(a*e,i*e,o*e),s.updateMatrix(),this.add(s)}}},{key:"update",value:function(e){var t=e.index,n=e.position,r=e.color,o=e.normal,i=this.geometry;i.attributes.position?(i.attributes.position.setArray(n),i.attributes.position.needsUpdate=!0):i.addAttribute("position",new I.b(n,3)),i.attributes.color?(i.attributes.color.setArray(r),i.attributes.color.needsUpdate=!0):i.addAttribute("color",new I.b(r,3)),i.attributes.normal?(i.attributes.normal.setArray(o),i.attributes.normal.needsUpdate=!0):i.addAttribute("normal",new I.b(o,3)),i.index?(i.index.setArray(t),i.index.needsUpdate=!0):i.setIndex(new I.b(t,1)),i.computeBoundingSphere(),this.visible=!0}}])&&st(n.prototype,r),o&&st(n,o),t}();function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ht(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function yt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bt(e,t){return!t||"object"!==pt(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function vt(e){return(vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),bt(this,vt(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,i["PureComponent"]),n=t,(r=[{key:"componentDidMount",value:function(){var e=this.props,t=e.match.params.slug,n=e.renderer.current,r=e.fetch,o=n.resetScene();this.picker=new it({anisotropy:n.getMaxAnisotropy()}),n.hands.children[1].add(this.picker),this.intersects=[this.picker],this.voxels=new ft,o.add(this.voxels),this.head=new I.t,this.renderer=n,(this.scene=o).onBeforeRender=this.onBeforeRender.bind(this),r(t)}},{key:"componentDidUpdate",value:function(e){var t=e.geometry,n=e.size,r=this.props,o=r.geometry,i=r.size,a=this.renderer.room,s=this.picker,c=this.voxels;i!==n&&(a.position.set(.5*i,.5*i,.5*i),c.resize(i),this.intersects=[s].concat(yt(c.children))),o!==t&&c.update(o)}},{key:"componentWillUnmount",value:function(){var e=this.picker,t=this.renderer,n=this.scene,r=this.props.reset;t.hands.children[1].remove(e),delete n.onBeforeRender,r(),t.renderer.vr.enabled||t.resetCamera()}},{key:"onBeforeRender",value:function(e,t,h){var y=this.head,d=this.intersects,b=this.picker,n=this.props,v=n.size,m=n.updateVoxels,r=this.renderer,o=r.hands,g=r.raycaster,w=r.room;o.children.forEach(function(e){var t=e.buttons,n=e.pointer;e.setupRaycaster(g);var r=g.intersectObjects(d)[0]||!1;if(r){var o=r.distance,i=r.face.normal,a=r.object,s=r.point;if(n.scale.z=o-.175,n.visible=!0,a!==b){if(t.padDown&&0===i.x&&1===i.y&&0===i.z){y.setFromMatrixPosition(h.matrixWorld);var c={x:y.x-w.position.x,y:0,z:y.z-w.position.z},u=ht(["x","y","z"].map(function(e){for(var t=s[e]-c[e];t<0;)t+=v;for(;v<=t;)t-=v;return t}),3),l=u[0],f=u[1],p=u[2];w.position.set(l,f,p)}(t.triggerDown||t.gripDown)&&m({color:b.color,point:s,normal:i,remove:t.gripDown})}else t.triggerDown&&b.onPointer(s)}else n.visible=!1});var i=e.animation;if(!e.vr.enabled&&v){var a=i.delta,s=i.time,c=.001*Math.sin(.1*s);h.rotateY(c),h.rotateX(c),h.translateZ(.5*a),h.updateMatrixWorld(),["x","y","z"].forEach(function(e){h.position[e]<0&&(h.position[e]+=v),h.position[e]>=v&&(h.position[e]-=v)})}}},{key:"render",value:function(){return null}}])&&dt(n.prototype,r),o&&dt(n,o),t}();gt.propTypes={match:$.a.shape({params:$.a.shape({slug:$.a.string.isRequired}).isRequired}).isRequired,geometry:$.a.shape({index:$.a.instanceOf(Uint32Array),position:$.a.instanceOf(Float32Array),color:$.a.instanceOf(Float32Array),normal:$.a.instanceOf(Float32Array)}).isRequired,size:$.a.number.isRequired,renderer:$.a.shape({current:$.a.instanceOf(K)}).isRequired,fetch:$.a.func.isRequired,reset:$.a.func.isRequired,updateVoxels:$.a.func.isRequired};var wt=Object(u.connect)(function(e){var t=e.realm;return{geometry:t.geometry,size:t.size}},{fetch:function(e){return function(n){return n({type:"REALM/FETCH",payload:E.fetch({endpoint:"realm/".concat(e)}).then(function(t){return E.fetch({endpoint:"realm/".concat(t._id,"/voxels")}).then(function(e){return e=new Uint32Array(e),n(Qe({size:t.size,voxels:e})),function(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},t=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){var t,n,r;t=o,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r})}return o}({},t,{voxels:e})})})})}},reset:function(){return{type:v}},updateVoxels:function(e){var y=e.color,d=e.normal,b=e.point,v=e.remove;return function(e,t){var n=t().realm,r=n.size,o=n.voxels,i=Ke(["x","y","z"].map(function(e){for(var t=Math.floor(b[e]+.5*d[e]*(v?-1:1));t<0;)t+=r;for(;r<=t;)t-=r;return t}),3),a=i[0],s=i[1],c=i[2],u=Math.min(Math.max(Math.round(255*y.r+8*Math.random()-4),0),255),l=Math.min(Math.max(Math.round(255*y.g+8*Math.random()-4),0),255),f=Math.min(Math.max(Math.round(255*y.b+8*Math.random()-4),0),255),p=v?0:1<<24|u<<16|l<<8|f,h=new Uint32Array(o);return h[c*r*r+s*r+a]=p,e(Qe({size:r,voxels:h})),e({type:m,payload:{voxels:h}})}}})(gt);function Ot(){return(Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function St(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Et=function(e){var t=e.component,n=e.renderer,r=St(e,["component","renderer"]);return a.a.createElement(p.b,Ot({},r,{render:function(e){return a.a.createElement(t,Ot({},e,{renderer:n}))}}))};Et.propTypes={component:$.a.func.isRequired,renderer:$.a.shape({current:$.a.instanceOf(K)}).isRequired};var xt=function(e){var t=e.renderer;return a.a.createElement(p.d,null,a.a.createElement(Et,{exact:!0,path:"/",component:Ve,renderer:t}),a.a.createElement(Et,{exact:!0,path:"/:slug",component:wt,renderer:t}),a.a.createElement(p.a,{to:"/"}))};xt.propTypes={renderer:$.a.shape({current:$.a.instanceOf(K)}).isRequired};var jt=xt;function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pt(e,t){return!t||"object"!==_t(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function kt(e){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tt,At,Ct,Dt,Lt=U.a.div.withConfig({displayName:"layout__Wrapper",componentId:"d2i6t1-0"})(["width:100vw;height:100vh;"]),Ut={backgroundColor:"#393",zIndex:1},It=function(e){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=Pt(this,kt(n).call(this,e))).renderer=a.a.createRef(),t}var t,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(n,i["PureComponent"]),t=n,(r=[{key:"render",value:function(){var e=this.renderer;return a.a.createElement("div",null,a.a.createElement(f.a,{style:Ut}),a.a.createElement(Lt,null,a.a.createElement(K,{ref:e})),a.a.createElement(jt,{renderer:e}),a.a.createElement(ce,null))}}])&&Rt(t.prototype,r),o&&Rt(t,o),n}(),zt=(window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__,s.d),Ft=Object(s.e)(L,{},zt(Object(s.a)(h.a,c.a,Object(l.loadingBarMiddleware)())));Tt=Ft,At=localStorage.getItem("REALMSVR::LOCALE"),Ct=((window.navigator.languages?window.navigator.languages[0]:null)||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage||P).substr(0,2).toLowerCase(),Dt=P,~R.indexOf(At)?Dt=At:~R.indexOf(Ct)&&(Dt=Ct),Object(y.syncTranslationWithStore)(Tt),Tt.dispatch(Object(y.loadTranslations)(k)),Tt.dispatch(Object(y.setLocale)(Dt)),Ft.getState().user.isAuth&&Ft.dispatch(x());var qt=Object(r.a)({basename:"/"});window.location.hash&&qt.replace("/".concat(window.location.hash.substr(2))),window.addEventListener("contextmenu",function(e){return e.preventDefault()},!1);var Bt=document.getElementById("mount");Object(o.render)(a.a.createElement(u.Provider,{store:Ft},a.a.createElement(p.c,{history:qt},a.a.createElement(It,null))),Bt)},f7Ve:function(e,t,n){e.exports=function(){return new Worker(n.p+"code/mesher.worker.cdf4d0fc1592aac67598.js")}},p2bk:function(e,t,n){}},[[0,1,2]]]);
//# sourceMappingURL=main.78a01104f3eaf6642f7ae6dd0e61e51a.js.map