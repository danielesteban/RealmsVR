(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{0:function(e,t,r){r("55Il"),r("p2bk"),e.exports=r("7RL8")},1:function(e,t){},"7RL8":function(e,t,r){"use strict";r.r(t);var n=r("LhCv"),i=r("q1tI"),u=r.n(i),o=r("i8i4"),a=r("ANjH"),s=r("Igns"),c=r("/MKj"),l=r("gyEF"),f=r.n(l),p=r("Ty5D"),h=r("sINF"),y=r("N2Rb"),d="REALM/FETCH_FULFILLED",v="REALM/UPDATE_GEOMETRY",m="REALM/UPDATE_VOXELS",b="REALM/RESET",g="USER/REFRESH_SESSION_FULFILLED",w="USER/REFRESH_SESSION_REJECTED",O="USER/SIGNOUT";function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var S=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseURL="https://projects.gatunes.com/realmsvr/"}var t,r,n;return t=e,(r=[{key:"fetch",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t=e.body,r=e.endpoint,n=e.headers,o=void 0===n?{}:n,i=e.method,a=void 0===i?"GET":i,s=this.authorization,c=this.baseURL;return s&&(o.Authorization=s),!t||t instanceof FormData||(t=JSON.stringify(t),o["Content-Type"]="application/json"),fetch("".concat(c).concat(r),{body:t,headers:o,method:a}).then(function(e){var t=e.headers,r=e.status;if(r<200||400<=r)throw new Error(r);switch((t.get("Content-Type")||"").split(";")[0]){case"text/plain":return e.arrayBuffer();case"application/json":return e.json();default:return e}})})},{key:"setAuthorization",value:function(e){e?this.authorization="Bearer ".concat(e):delete this.authorization,this.token=e}}])&&x(t.prototype,r),n&&x(t,n),e}());r("bo1M");var E=r("wcCE");var _={en:{NotFound:{description:"This is not the web page you're looking for.",goBack:"Take me back home"},User:{signIn:"Sign-In",signOut:"Sign-Out"}},es:{NotFound:{description:"Esta no es la página que estás buscando.",goBack:"Volver al inicio"},User:{signIn:"Iniciar sesión",signOut:"Cerrar sesión"}}},j=Object.keys(_),k="en",R={};j.forEach(function(e){R[e]=Object(E.recursive)(!0,_.en,_[e])});var P=Object(a.c)({realms:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length?arguments[1]:void 0;switch(t.type){case"LOBBY/FETCH_REALMS_FULFILLED":return t.payload;default:return e}}}),C=Object(a.c)({geometry:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;switch(t.type){case"REALM/UPDATE_GEOMETRY_FULFILLED":return t.payload;case b:return{};default:return e}},id:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length?arguments[1]:void 0;switch(t.type){case d:return t.payload._id;case b:return"";default:return e}},name:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length?arguments[1]:void 0;switch(t.type){case d:return t.payload.name;case b:return"";default:return e}},size:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length?arguments[1]:void 0;switch(t.type){case d:return t.payload.size;case b:return 0;default:return e}},voxels:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Uint32Array,t=1<arguments.length?arguments[1]:void 0;switch(t.type){case d:case m:return t.payload.voxels;case b:return new Uint32Array;default:return e}}}),A="REALMSVR::SESSION",M=JSON.parse(localStorage.getItem(A)||"false");M&&S.setAuthorization(M.token);var T=Object(a.c)({isAuth:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!!M;switch((1<arguments.length?arguments[1]:void 0).type){case g:return!0;case w:case O:return!1;default:return e}},profile:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:M?M.profile:{},t=1<arguments.length?arguments[1]:void 0;switch(t.type){case g:return t.payload.profile;case w:case O:return{};default:return e}},token:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:M?M.token:{},t=1<arguments.length?arguments[1]:void 0;switch(t.type){case g:return S.setAuthorization(t.payload.token),localStorage.setItem(A,JSON.stringify(t.payload)),t.payload.token;case w:case O:return S.setAuthorization(!1),localStorage.removeItem(A),"";default:return e}}}),D=Object(a.c)({i18n:y.i18nReducer,loadingBar:l.loadingBarReducer,lobby:P,realm:C,user:T}),L=r("vOnD");function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var G=L.a.div.withConfig({displayName:"music__Wrapper",componentId:"sc-1qpg9ee-0"})(["position:fixed;bottom:0;left:0;display:flex;align-items:flex-end;> a > img{width:100px;height:100px;background:#000;border:0;outline:none;}> div{background:rgba(0,0,0,.5);font-size:1.4em;line-height:1.5em;padding:0.5rem 1rem;border-radius:0 4px 0 0;> a{display:block;text-decoration:none;outline:none;&:hover{text-decoration:underline;}}> a:nth-child(1){color:#eee;}> a:nth-child(2){color:#aaa;}}"]),H=function(e){function c(e){var t,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),r=this,t=!(n=F(c).call(this,e))||"object"!==I(n)&&"function"!=typeof n?B(r):n;for(var o=z(c.tracks),i=o.length-1;0<=i;i-=1){var a=Math.floor(Math.random()*o.length),s=o[i];o[i]=o[a],o[a]=s}return t.player=document.createElement("audio"),t.player.onended=t.next.bind(B(t)),t.player.volume=.5,t.state={track:void 0},t.tracks=o,t.track=0,t}var t,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(c,i["PureComponent"]),t=c,(r=[{key:"componentDidMount",value:function(){this.waitForFirstInteraction()}},{key:"waitForFirstInteraction",value:function(){var t=this,e=function e(){window.removeEventListener("mousedown",e),window.removeEventListener("touchstart",e),window.removeEventListener("vrdisplayactivate",e),t.play()};window.addEventListener("mousedown",e,!1),window.addEventListener("touchstart",e,!1),window.addEventListener("vrdisplayactivate",e,!1)}},{key:"next",value:function(){var e=this.player;e.paused||e.pause(),e.src="",this.track=(this.track+1)%this.tracks.length,this.play()}},{key:"play",value:function(){var t=this,r=this.player,e=this.track,n=this.tracks,o="client_id=eb5fcff9e107aab508431b4c3c416415",i=n[e];fetch("https://api.soundcloud.com/tracks/".concat(i,"?format=json&").concat(o)).then(function(e){return e.json()}).then(function(e){if(!e)throw new Error("Couldn't fetch track: ".concat(i));r.src="".concat(e.stream_url,"?").concat(o),r.play(),t.setState({track:e})}).catch(function(){return t.next()})}},{key:"render",value:function(){var e=this.state.track;if(!e)return null;var t=e.title,r=e.artwork_url,n=e.permalink_url,o=e.user,i=o.username,a=o.permalink_url,s=e.waveform_url;return u.a.createElement(G,null,u.a.createElement("a",{href:n,rel:"noopener noreferrer",target:"_blank"},u.a.createElement("img",{alt:t,src:r||s})),u.a.createElement("div",null,u.a.createElement("a",{href:n,rel:"noopener noreferrer",target:"_blank"},t),u.a.createElement("a",{href:a,rel:"noopener noreferrer",target:"_blank"},i)))}}])&&U(t.prototype,r),n&&U(t,n),c}();H.tracks=[334831124,3654595,3654647,62965282,55529274,40801532,28921242,58102473,65194517,44049414,584470,348172961,348172759,118227213,58103033,58102746,255599053,29062473,73664676,217254339,26016069,143994169,34751566,22899851,19645145,14604316,14604145,9747273,290203217,290202627,290203029,290203125,230280393,230280565,230280839,290202890,230280665,230280740,174033188,238809205,219872323,85441920,85442027,85442324,85442658,295429557,31232642,118720768,66345578,64979755,9747680,3654444,354826097,174209343,374346584,374346578,374346566,374346536,374346518,374346506,374346440,272272960,82537981,272272962,331110005,253646536,69972925,297108748,95089740,264157290,3654394,51204969,28460870,270165801,93513660,107137565,200476847,241036508,345846433,13728685,3193491,235796705,74366070,293115267,65027631,226460783,132730188,267647225,331743020,348075711,328602395,232135696,13385987,303726380];var N=H,V=(r("MZFn"),r("Womt"));function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var K=function(e){function i(){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),i.mesh&&i.pointerMesh||i.setup(),r=X(this,Y(i).call(this));for(var n=i.mesh,o=i.pointerMesh,e=function(e){var t=n.clone();t.buttons={menu:!1,menuDown:!1,menuUp:!1,grip:!1,gripDown:!1,gripUp:!1,pad:!1,padDown:!1,padUp:!1,trigger:!1,triggerDown:!1,triggerUp:!1},t.pointer=o.clone(),t.pointer.visible=!1,t.add(t.pointer),t.matrixAutoUpdate=!1,t.setupRaycaster=function(e){return i.setupRaycaster({hand:t,raycaster:e})},t.visible=!1,r.add(t)},t=0;t<2;t+=1)e();return r}var t,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(i,V["q"]),t=i,n=[{key:"setupRaycaster",value:function(e){var t=e.hand,r=e.raycaster;t.auxMatrix||(t.auxMatrix=new V.n);var n=t.auxMatrix,o=t.matrixWorld;n.identity().extractRotation(o),r.ray.origin.setFromMatrixPosition(o),r.ray.direction.set(0,0,-1).applyMatrix4(n),r.ray.origin.addScaledVector(r.ray.direction,-.175)}},{key:"setup",value:function(){if(!i.geometry){var e=new V.a(1,1,1);e.scale(.05,.03,.2),e.translate(0,0,.075),e.faces.forEach(function(e,t){e.color.set(7829367),10<=t&&t<=11&&e.color.offsetHSL(0,0,-.1)}),i.geometry=(new V.c).fromGeometry(e)}i.material||(i.material=new V.p({color:16769213})),i.mesh||(i.mesh=new V.o(i.geometry,i.material)),i.pointerGeometry||(i.pointerGeometry=(new V.c).setFromPoints([new V.A(0,0,0),new V.A(0,0,-1)])),i.pointerMaterial||(i.pointerMaterial=new V.m({color:16769213})),i.pointerMesh||(i.pointerMesh=new V.l(i.pointerGeometry,i.pointerMaterial))}}],(r=[{key:"update",value:function(){var e=this.children,t="getGamepads"in navigator?navigator.getGamepads():[];e.forEach(function(e){e.visible=!1});for(var r=0,n=0;n<t.length;n+=1){var o=t[n];if(o&&("OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("Spatial Controller"))&&(o.pose&&this.updateHand({hand:e[r],buttons:o.buttons,pose:o.pose}),1<(r+=1)))break}}},{key:"updateHand",value:function(e){var t=e.hand,r=e.buttons,n=e.pose,o=this.standingMatrix;null!==n.position&&t.position.fromArray(n.position),null!==n.orientation&&t.quaternion.fromArray(n.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(o),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var i=r[3]&&r[3].pressed;t.buttons.menuDown=i&&t.buttons.menu!==i,t.buttons.menuUp=!i&&t.buttons.menu!==i,t.buttons.menu=i;var a=r[2]&&r[2].pressed;t.buttons.gripDown=a&&t.buttons.grip!==a,t.buttons.gripUp=!a&&t.buttons.grip!==a,t.buttons.grip=a;var s=r[0]&&r[0].pressed;t.buttons.padDown=s&&t.buttons.pad!==s,t.buttons.padUp=!s&&t.buttons.pad!==s,t.buttons.pad=s;var c=r[1]&&r[1].pressed;t.buttons.triggerDown=c&&t.buttons.trigger!==c,t.buttons.triggerUp=!c&&t.buttons.trigger!==c,t.buttons.trigger=c}}])&&J(t.prototype,r),n&&J(t,n),i}();function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function te(e){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ne(e,t){return(ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var oe=function(e){function o(e){var t,r,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),r=this,(t=!(n=te(o).call(this,e))||"object"!==Q(n)&&"function"!=typeof n?re(r):n).canvas=u.a.createRef(),t.onAnimationTick=t.onAnimationTick.bind(re(t)),t.onResize=t.onResize.bind(re(t)),t}var t,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ne(e,t)}(o,i["Component"]),t=o,(r=[{key:"componentDidMount",value:function(){var e=this.canvas.current;this.camera=new V.r(90,1,.1,1024),this.clock=new V.e,this.raycaster=new V.u,this.raycaster.far=32,this.room=new V.q,this.room.add(this.camera),this.hands=new K,this.room.add(this.hands),this.resetCamera(),this.resetScene();var t=new V.C({antialias:!0,canvas:e,powerPreference:"high-performance",stencil:!1});t.setPixelRatio(window.devicePixelRatio||1),t.setClearColor(this.scene.fog.color),t.setAnimationLoop(this.onAnimationTick),window.addEventListener("resize",this.onResize,!1),this.renderer=t,this.onResize(),this.setupVR()}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"onAnimationTick",value:function(){var e=this.camera,t=this.clock,r=this.hands,n=this.renderer,o=this.scene,i=this.stats;i&&i.begin(),n.animation={delta:t.getDelta(),time:t.oldTime/1e3},r.update(),n.render(o,e),i&&i.end()}},{key:"onResize",value:function(){var e=this.canvas.current,t=this.camera,r=this.renderer,n=e.parentNode.getBoundingClientRect(),o=n.width,i=n.height;this.width=o,this.height=i,r.vr.isPresenting()||r.setSize(o,i),t.aspect=o/i,t.updateProjectionMatrix()}},{key:"getMaxAnisotropy",value:function(){return this.renderer.capabilities.getMaxAnisotropy()}},{key:"setupVR",value:function(){var e=this.hands,r=this.renderer,t="xr"in navigator,n="getVRDisplays"in navigator;if(t){var o=function(){if(!r.vr.isPresenting()){var e=r.vr.getDevice();e?e.requestSession({immersive:!0,exclusive:!0}).then(function(e){r.vr.setSession(e,{frameOfReferenceType:"stage"})}):navigator.xr.requestDevice().then(function(e){r.vr.enabled=!0,r.vr.setDevice(e)})}};window.addEventListener("mousedown",o,!1),o()}else if(n){var i=function(){if(!r.vr.isPresenting()){var e=r.vr.getDevice();e?e.requestPresent([{source:r.domElement}]):navigator.getVRDisplays().then(function(e){if(e.length){var t=$(e,1)[0];r.vr.enabled=!0,r.vr.setDevice(t)}})}};window.addEventListener("mousedown",i,!1),window.addEventListener("vrdisplayactivate",i,!1),i()}e.standingMatrix=r.vr.getStandingMatrix()}},{key:"resetCamera",value:function(){var e=this.camera;e.position.set(0,1.6,0),e.rotation.set(0,0,0)}},{key:"resetScene",value:function(){return this.scene&&this.scene.children.forEach(function(e){e.dispose&&e.dispose()}),this.room.position.set(0,0,0),this.scene=new V.v,this.scene.add(this.room),this.scene.fog=new V.h(0,.015),this.scene.fog.color.setRGB(0,0,.1),this.scene}},{key:"render",value:function(){var e=this.canvas;return u.a.createElement("canvas",{ref:e})}}])&&ee(t.prototype,r),n&&ee(t,n),o}();V.w.fog_pars_vertex=V.w.fog_pars_vertex.replace("varying float fogDepth;","varying vec4 fogDepth;"),V.w.fog_vertex=V.w.fog_vertex.replace("fogDepth = -mvPosition.z;","fogDepth = mvPosition;"),V.w.fog_pars_fragment=V.w.fog_pars_fragment.replace("varying float fogDepth;","varying vec4 fogDepth;"),V.w.fog_fragment=V.w.fog_fragment.replace("float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );",["float fogDist = length(fogDepth);","float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDist * fogDist * LOG2 ) );"].join("\n")).replace("float fogFactor = smoothstep( fogNear, fogFar, fogDepth );","float fogFactor = smoothstep( fogNear, fogFar, length(fogDepth) );");var ie=oe,ae=r("17x9"),se=r.n(ae),ce=r("1339"),ue=r.n(ce);function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pe(e,t){return!t||"object"!==le(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var de=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),t.geometry&&t.material||t.setup(),pe(this,he(t).call(this,t.geometry,t.material))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(t,V["o"]),r=t,o=[{key:"setup",value:function(){if(!t.geometry){var e=new V.t(256,256,256,256);e.rotateX(-.5*Math.PI);var r=new V.f;e.faces.forEach(function(e,t){t%2==1?e.color.copy(r):(e.color.setHex(6710869),e.color.offsetHSL(0,0,-.1*Math.random()),r.copy(e.color))}),t.geometry=(new V.c).fromGeometry(e)}t.material||(t.material=new V.p({vertexColors:V.B}))}}],(n=null)&&fe(r.prototype,n),o&&fe(r,o),t}();function ve(e){return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function me(e,t){return!t||"object"!==ve(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Oe=function(e){function i(e){var t,r=e.anisotropy;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),i.backplate&&i.geometry||i.setup();var n=document.createElement("canvas");n.width=512,n.height=512;var o=new V.d(n);return o.anisotropy=r,(t=me(this,ge(i).call(this,i.geometry,new V.p({map:o})))).add(i.backplate.clone()),t.context=n.getContext("2d"),t.pointer=new V.A,t.renderer=n,t.texture=o,t}var t,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(i,V["o"]),t=i,n=[{key:"setup",value:function(){if(!i.backplate){var e=new V.o(new V.s(1,1),new V.p({color:1118481}));e.geometry.rotateY(Math.PI),i.backplate=e}i.geometry||(i.geometry=new V.s(1,1))}}],(r=[{key:"dispose",value:function(){var e=this.material,t=this.texture;e.dispose(),t.dispose()}},{key:"draw",value:function(){var e=this.context,t=this.renderer,r=this.texture;e.fillStyle="#111",e.fillRect(0,0,t.width,t.height),r.needsUpdate=!0}},{key:"onPointer",value:function(e){var t=this.pointer,r=this.renderer;this.worldToLocal(t.copy(e)),t.set((t.x+.5)*r.width,(1-(t.y+.5))*r.height,0)}}])&&be(t.prototype,r),n&&be(t,n),i}();function xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Se=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loaded={}}var t,r,n;return t=e,(r=[{key:"waitUntilLoaded",value:function(e){var a=this.loaded;return Array.isArray(e)||(e=[e]),Promise.all(e.map(function(i){return new Promise(function(r){if(a[i])r();else{var n=document.createElement("div");n.innerText="QW@HhsXJ",n.style.position="absolute",n.style.fontFamily="sans-serif",n.style.top="-999999px",document.body.appendChild(n);var o=n.getBoundingClientRect().width;n.style.fontFamily=i,setTimeout(function e(){var t=n.getBoundingClientRect().width;if(1<Math.abs(t-o))return document.body.removeChild(n),a[i]=!0,void r();setTimeout(e,10)},10)}})}))}}])&&xe(t.prototype,r),n&&xe(t,n),e}());function Ee(e,t,r){return(Ee="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ce(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Re(e,t,r){return t&&ke(e.prototype,t),r&&ke(e,r),e}function Pe(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Te=function(e){function t(){return je(this,t),t.geometry&&t.material||t.setup(),Pe(this,Ce(t).call(this,t.geometry,t.material))}return Ae(t,V["o"]),Re(t,null,[{key:"setup",value:function(){if(!t.geometry){var e=new V.g(.025,.025,.5,8,16);e.translate(0,-.32,0);var r=new V.f;e.faces.forEach(function(e,t){t%2==1?e.color.copy(r):(e.color.setHex(5596757),e.color.offsetHSL(0,0,-.1*Math.random()),r.copy(e.color))}),t.geometry=(new V.c).fromGeometry(e)}t.material||(t.material=new V.p({vertexColors:V.B}))}}]),t}(),De=function(e){function p(e){var t,r=e.anisotropy,n=e.name,o=e.onPointer,i=e.screenshot;je(this,p),(t=Pe(this,Ce(p).call(this,{anisotropy:r}))).scale.set(.25,.25,1),t.name=n,t.onPointer=o;var a=t.renderer,s=a.width,c=a.height,u=t.context.createRadialGradient(.5*s,.5*c,.2*s,.5*s,.5*c,.5*s);u.addColorStop(0,"rgba(0, 0, 0, 0)"),u.addColorStop(1,"rgba(0, 0, 0, .5)"),t.vignette=u;var l=!1;if(Se.waitUntilLoaded("Roboto").then(function(){l=!0,t.draw()}),i){var f=new Image;f.src="data:image/jpeg;base64,".concat(i),f.onload=function(){t.screenshot=f,l&&t.draw()}}return t}return Ae(p,Oe),Re(p,[{key:"draw",value:function(){var e=this.context,t=this.isHover,r=this.name,n=this.renderer,o=this.screenshot,i=this.vignette;Ee(Ce(p.prototype),"draw",this).call(this),o&&e.drawImage(o,0,0),e.fillStyle=i,e.fillRect(0,0,n.width,n.height),e.fillStyle="rgba(".concat(t?"255, 255, 255":"0, 0, 0",", .5)"),e.fillRect(0,.75*n.height,n.width,.25*n.height),e.font="700 60px Roboto",e.textAlign="center",e.textBaseline="middle",e.fillStyle=t?"#333":"#fff",e.fillText(r,.5*n.width,.875*n.height)}}]),p}(),Le=function(e){function o(e){var t,r=e.anisotropy,n=e.history;return je(this,o),(t=Pe(this,Ce(o).call(this))).anisotropy=r,t.history=n,t.hover={},t.intersects=[],t.position.set(0,1.25,-1),t}return Ae(o,V["q"]),Re(o,[{key:"dispose",value:function(){this.children.forEach(function(e){return e.dispose&&e.dispose()})}},{key:"setHover",value:function(e){var t=e.hand,r=e.realm,n=this.hover;n[t]&&(n[t].isHover=!1,n[t].draw()),r&&(r.isHover=!0,r.draw()),this.hover[t]=r}},{key:"update",value:function(e){for(var i=this,r=this.anisotropy,t=this.children,a=this.history,s=this.intersects;t.length;)this.remove(t[0]);s.length=0;var c=.25+-.25*e.length;e.forEach(function(n,e){var o=new De(function(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},t=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){var t,r,n;t=o,n=i[r=e],r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n})}return o}({},n,{anisotropy:r,onPointer:function(e){var t=e.hand,r=e.isDown;i.setHover({hand:t,realm:o}),r&&a.push("/".concat(n.slug))}}));o.position.set(c+.5*e,0,0),o.lookAt(0,.5,1),i.add(o),s.push(o);var t=new Te;t.position.copy(o.position),i.add(t)})}}]),o}();function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ue(e,t){return!t||"object"!==Ie(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qe=function(e){function i(e){var t,r=e.anisotropy;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var n=document.createElement("canvas");n.width=1024,n.height=1024;var o=new V.d(n);return o.anisotropy=r,(t=Ue(this,Fe(i).call(this,new V.s(2,2),new V.p({map:o,transparent:!0})))).lookAt(0,-.2,1),t.position.set(0,2,-3),t.renderer=n,t.texture=o,Se.waitUntilLoaded("Roboto").then(function(){return t.draw()}),t}var t,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(i,V["o"]),t=i,(r=[{key:"dispose",value:function(){var e=this.geometry,t=this.material,r=this.texture;e.dispose(),t.dispose(),r.dispose()}},{key:"draw",value:function(){var e=this.renderer,t=this.texture,r=e.getContext("2d"),n=r.createLinearGradient(0,0,0,e.height);n.addColorStop(0,"rgba(0,0,0,0.25)"),n.addColorStop(1,"rgba(0,0,0,0)"),r.fillStyle=n,r.fillRect(0,0,e.width,e.height),r.font="700 200px Roboto",r.textAlign="center",r.textBaseline="middle",r.fillStyle="#eee",r.shadowColor="rgba(255, 255, 0, .5)",r.shadowBlur=50,r.fillText("RealmsVR",.5*e.width,.2*e.height),r.font="70px Roboto",r.fillStyle="#999",r.shadowBlur=0,r.fillText("A recursive VR experience",.5*e.width,.5*e.height),r.font="50px Roboto",r.fillStyle="#111",r.fillText("v".concat("0.0.50"," - dani@gatunes © 2019"),.5*e.width,.85*e.height),t.needsUpdate=!0}}])&&ze(t.prototype,r),n&&ze(t,n),i}();function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function He(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ve(e,t){return!t||"object"!==Ge(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xe=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ve(this,We(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,i["PureComponent"]),r=t,(n=[{key:"componentDidMount",value:function(){var e=this.props,t=e.history,r=e.renderer.current,n=e.fetchRealms,o=r.getMaxAnisotropy(),i=r.resetScene();i.add(new de),i.add(new qe({anisotropy:o})),this.menu=new Le({anisotropy:o,history:t}),i.add(this.menu),this.renderer=r,(this.scene=i).onBeforeRender=this.onBeforeRender.bind(this),r.renderer.vr.enabled||(this.touches=ue()(window,{filtered:!0,target:r.canvas.current}).on("start",this.onPointerDown.bind(this))),n({page:0})}},{key:"componentDidUpdate",value:function(e){var t=e.realms,r=this.props.realms;r!==t&&this.menu.update(r)}},{key:"componentWillUnmount",value:function(){var e=this.scene,t=this.touches;delete e.onBeforeRender,t&&t.disable()}},{key:"onBeforeRender",value:function(){var s=this.menu,e=this.renderer,t=e.hands,c=e.raycaster;t.children.forEach(function(e,t){var r=e.buttons,n=e.pointer;e.setupRaycaster(c);var o=c.intersectObjects(s.intersects)[0]||!1;if(!o)return n.visible=!1,void s.setHover({hand:t});var i=o.distance,a=o.object;n.scale.z=i-.175,n.visible=!0,a.onPointer({hand:t,isDown:r.triggerDown})})}},{key:"onPointerDown",value:function(e,t){var r=He(t,2),n=r[0],o=r[1],i=this.menu,a=this.renderer,s=a.camera,c=a.raycaster,u=a.width,l=a.height;c.setFromCamera({x:-2*Math.min(Math.max(.5-n/u,-.5),.5),y:2*Math.min(Math.max(.5-o/l,-.5),.5)},s);var f=c.intersectObjects(i.intersects)[0]||!1;f&&f.object.onPointer({hand:0,isDown:!0})}},{key:"render",value:function(){return null}}])&&Ne(r.prototype,n),o&&Ne(r,o),t}();Xe.propTypes={history:se.a.object.isRequired,realms:se.a.arrayOf(se.a.shape({name:se.a.string.isRequired,slug:se.a.string.isRequired})).isRequired,renderer:se.a.shape({current:se.a.instanceOf(ie)}).isRequired,fetchRealms:se.a.func.isRequired};var Ye=Object(c.connect)(function(e){return{realms:e.lobby.realms}},{fetchRealms:function(e){var t=e.page,r=void 0===t?0:t;return{type:"LOBBY/FETCH_REALMS",payload:S.fetch({endpoint:"realms/".concat(r)})}}})(Xe),Ze=r("f7Ve"),Ke=r.n(Ze);function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $e=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.promiseId=0,this.promises={},this.worker=new Ke.a,this.worker.onmessage=this.onMessage.bind(this)}var t,r,n;return t=e,(r=[{key:"generate",value:function(e){var t=this,r=e.size,n=e.voxels,o=this.promiseId,i=this.promises,a=this.worker;return new Promise(function(e){i[o]=e,t.promiseId+=1,a.postMessage({promiseId:o,size:r,voxels:n})})}},{key:"onMessage",value:function(e){var t=e.data,r=t.geometry,n=t.promiseId,o=this.promises;o[n](r),delete o[n]}}])&&Qe(t.prototype,r),n&&Qe(t,n),e}());function et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function tt(e){var t=e.size,r=e.voxels;return{type:v,payload:$e.generate({size:t,voxels:r})}}function rt(e){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function it(e,t,r){return(it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=at(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function at(e){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function st(e,t){return(st=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ct=function(e){function g(e){var t,r,n,o=e.anisotropy;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),r=this;var i=ot(t=!(n=at(g).call(this,{anisotropy:o}))||"object"!==rt(n)&&"function"!=typeof n?ot(r):n).renderer;return t.position.set(-.15,.15,.075),t.rotation.set(0,.5*Math.PI,.1*Math.PI,"ZYX"),t.scale.set(.3,.3,1),t.block={x:.05*i.width,y:.05*i.height,width:.75*i.width,height:.75*i.height},t.strip={x:.85*i.width,y:.05*i.height,width:.1*i.width,height:.75*i.height},t.blockColor=new V.f,t.color=new V.f,t.blockColor.setRGB(1,0,0),t.color.copy(t.blockColor),t.draw(),t}var t,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&st(e,t)}(g,Oe),t=g,(r=[{key:"draw",value:function(){var e=this.block,t=this.blockColor,r=this.color,n=this.context,o=this.renderer,i=this.strip;it(at(g.prototype),"draw",this).call(this);var a=e.x,s=e.y,c=e.width,u=e.height;n.save(),n.translate(a,s),n.fillStyle="#".concat(t.getHexString()),n.fillRect(0,0,c,u);var l=n.createLinearGradient(0,0,c,0);l.addColorStop(0,"rgba(255,255,255,1)"),l.addColorStop(1,"rgba(255,255,255,0)"),n.fillStyle=l,n.fillRect(0,0,c,u);var f=n.createLinearGradient(0,0,0,u);f.addColorStop(0,"rgba(0,0,0,0)"),f.addColorStop(1,"rgba(0,0,0,1)"),n.fillStyle=f,n.fillRect(0,0,c,u),n.restore();var p=i.x,h=i.y,y=i.width,d=i.height;n.save(),n.translate(p,h);var v=n.createLinearGradient(0,0,0,d);v.addColorStop(0,"rgba(255, 0, 0, 1)"),v.addColorStop(.17,"rgba(255, 255, 0, 1)"),v.addColorStop(.34,"rgba(0, 255, 0, 1)"),v.addColorStop(.51,"rgba(0, 255, 255, 1)"),v.addColorStop(.68,"rgba(0, 0, 255, 1)"),v.addColorStop(.85,"rgba(255, 0, 255, 1)"),v.addColorStop(1,"rgba(255, 0, 0, 1)"),n.fillStyle=v,n.fillRect(0,0,y,d),n.restore(),n.save();var b=.3*o.width,m=.1*o.width;n.translate(.35*o.width,.85*o.height),n.rect(0,0,b,m),n.fillStyle="#".concat(r.getHexString()),n.fillRect(0,0,b,m),n.restore()}},{key:"onPointer",value:function(e){var c=this,t=this.block,u=this.blockColor,l=this.color,f=this.context,p=this.pointer,r=this.strip;it(at(g.prototype),"onPointer",this).call(this,e),[t,r].forEach(function(e,t){var r=e.x,n=e.y,o=e.width,i=e.height;if(!(p.x<r||p.x>r+o||p.y<n||p.y>n+i)){var a=1===t,s=f.getImageData(p.x,p.y,1,1).data;a&&u.setRGB(s[0]/255,s[1]/255,s[2]/255),l.setRGB(s[0]/255,s[1]/255,s[2]/255),c.draw()}})}}])&&nt(t.prototype,r),n&&nt(t,n),g}();function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ft(e,t){return!t||"object"!==ut(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function pt(e){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ht(e,t){return(ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yt=function(e){function i(e){var t,r=e.instanced,n=void 0!==r&&r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=ft(this,pt(i).call(this)),n){var o=i.shader;t.geometry=new V.k,t.material=new V.y({vertexShader:o.vertex,fragmentShader:o.fragment,uniforms:o.uniforms,vertexColors:V.B,fog:!0})}else t.geometry=new V.c,t.material=new V.p({vertexColors:V.B});return t.instanced=n,t.visible=!1,t.aux={frustum:new V.i,matrix:new V.n},t}var t,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ht(e,t)}(i,V["q"]),t=i,(r=[{key:"dispose",value:function(){var e=this.geometry,t=this.material;e.dispose(),t.dispose()}},{key:"resize",value:function(e){for(var t=this,r=this.children,n=this.geometry,o=this.instanced,i=this.material;r.length;)this.remove(r[0]);this.instances=[];for(var a=new V.A,s=new V.A,c=-8;c<=8;c+=1)for(var u=-8;u<=8;u+=1)for(var l=-8;l<=8;l+=1){var f=a.set(l,u,c).distanceTo(s);if(Math.round(f)<=8){var p=new V.o(n,i);p.chunk={x:l,y:u,z:c},p.distance=f,p.matrixAutoUpdate=!1,p.position.set(l*e,u*e,c*e),p.updateMatrix(),p.updateMatrixWorld(),this.instances.push(p)}}if(this.instances.sort(function(e,t){return e.distance-t.distance}),this.intersects=this.instances.filter(function(e){var t=e.chunk,r=t.x,n=t.y,o=t.z;return-2<=r&&r<=2&&-2<=n&&n<=2&&-2<=o&&o<=2}),o){var h=new V.o(n,i);h.frustumCulled=!1,this.add(h);var y=new Float32Array(3*this.instances.length);n.attributes.offset?n.attributes.offset.setArray(y):(n.addAttribute("offset",new V.j(y,3)),n.attributes.offset.setDynamic(!0)),n.maxInstancedCount=0}else this.instances.forEach(function(e){return t.add(e)})}},{key:"updateFrustum",value:function(e){var t=this.aux,r=t.frustum,n=t.matrix,o=this.geometry,i=this.instanced,a=this.instances;if(i&&a){n.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),r.setFromMatrix(n);var s=a.filter(function(e){var t=e.worldSphere;return t&&r.intersectsSphere(t)}).reduce(function(e,t){var r=t.position;return e.push(r.x,r.y,r.z),e},[]);o.attributes.offset.array.set(s),o.attributes.offset.needsUpdate=!0,o.maxInstancedCount=s.length/3}}},{key:"update",value:function(e){var t=e.index,r=e.position,n=e.color,o=e.normal,i=this.geometry,a=this.instances;i.attributes.position?(i.attributes.position.setArray(r),i.attributes.position.needsUpdate=!0):i.addAttribute("position",new V.b(r,3)),i.attributes.color?(i.attributes.color.setArray(n),i.attributes.color.needsUpdate=!0):i.addAttribute("color",new V.b(n,3)),i.attributes.normal?(i.attributes.normal.setArray(o),i.attributes.normal.needsUpdate=!0):i.addAttribute("normal",new V.b(o,3)),i.index?(i.index.setArray(t),i.index.needsUpdate=!0):i.setIndex(new V.b(t,1)),i.computeBoundingSphere(),a.forEach(function(e){e.worldSphere=i.boundingSphere.clone().applyMatrix4(e.matrixWorld)}),this.visible=!0}}])&&lt(t.prototype,r),n&&lt(t,n),i}();yt.shader={vertex:V.x.basic.vertexShader.replace("#include <clipping_planes_pars_vertex>",["#include <clipping_planes_pars_vertex>","attribute vec3 offset;"].join("\n")).replace("#include <begin_vertex>",["vec3 transformed = vec3( offset + position );"].join("\n")),fragment:V.x.basic.fragmentShader,uniforms:V.z.clone(V.x.basic.uniforms)};var dt=yt;function vt(e){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function mt(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function gt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wt(e,t){return!t||"object"!==vt(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Ot(e){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var St=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),wt(this,Ot(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(t,i["PureComponent"]),r=t,(n=[{key:"componentDidMount",value:function(){var e=this.props,t=e.match.params.slug,r=e.renderer.current,n=e.fetch,o=r.resetScene();this.picker=new ct({anisotropy:r.getMaxAnisotropy()}),r.hands.children[1].add(this.picker),this.voxels=new dt({instanced:!!r.renderer.extensions.get("ANGLE_instanced_arrays")}),o.add(this.voxels),this.head=new V.A,this.intersects=[this.picker],this.renderer=r,(this.scene=o).onBeforeRender=this.onBeforeRender.bind(this),n(t)}},{key:"componentDidUpdate",value:function(e){var t=e.geometry,r=e.size,n=this.props,o=n.geometry,i=n.size,a=this.renderer.room,s=this.picker,c=this.voxels;i!==r&&(a.position.set(.5*i,.5*i,.5*i),c.resize(i),this.intersects=[s].concat(mt(c.intersects))),o!==t&&c.update(o)}},{key:"componentWillUnmount",value:function(){var e=this.picker,t=this.renderer,r=this.scene,n=this.props.reset;t.hands.children[1].remove(e),e.dispose(),delete r.onBeforeRender,n(),t.renderer.vr.enabled||t.resetCamera()}},{key:"onBeforeRender",value:function(e,t,h){var y=this.head,d=this.intersects,v=this.picker,r=this.props,b=r.size,m=r.updateVoxels,n=this.renderer,o=n.hands,g=n.raycaster,w=n.room;this.voxels.updateFrustum(h),o.children.forEach(function(e){var t=e.buttons,r=e.pointer;e.setupRaycaster(g);var n=g.intersectObjects(d)[0]||!1;if(n){var o=n.distance,i=n.face.normal,a=n.object,s=n.point;if(r.scale.z=o-.175,r.visible=!0,a!==v){if(t.padDown&&0===i.x&&1===i.y&&0===i.z){y.setFromMatrixPosition(h.matrixWorld);var c={x:y.x-w.position.x,y:0,z:y.z-w.position.z},u=bt(["x","y","z"].map(function(e){for(var t=s[e]-c[e];t<0;)t+=b;for(;b<=t;)t-=b;return t}),3),l=u[0],f=u[1],p=u[2];w.position.set(l,f,p)}(t.triggerDown||t.gripDown)&&m({color:v.color,point:s,normal:i,remove:t.gripDown})}else t.triggerDown&&v.onPointer(s)}else r.visible=!1});var i=e.animation;if(!e.vr.enabled&&b&&1<i.time){var a=i.delta,s=i.time,c=.001*Math.sin(.1*s);h.rotateY(c),h.rotateX(c),h.translateZ(.5*a),h.updateMatrixWorld(),["x","y","z"].forEach(function(e){h.position[e]<0&&(h.position[e]+=b),h.position[e]>=b&&(h.position[e]-=b)})}}},{key:"render",value:function(){return null}}])&&gt(r.prototype,n),o&&gt(r,o),t}();St.propTypes={match:se.a.shape({params:se.a.shape({slug:se.a.string.isRequired}).isRequired}).isRequired,geometry:se.a.shape({index:se.a.instanceOf(Uint32Array),position:se.a.instanceOf(Float32Array),color:se.a.instanceOf(Float32Array),normal:se.a.instanceOf(Float32Array)}).isRequired,size:se.a.number.isRequired,renderer:se.a.shape({current:se.a.instanceOf(ie)}).isRequired,fetch:se.a.func.isRequired,reset:se.a.func.isRequired,updateVoxels:se.a.func.isRequired};var Et=Object(c.connect)(function(e){var t=e.realm;return{geometry:t.geometry,size:t.size}},{fetch:function(e){return function(r){return r({type:"REALM/FETCH",payload:S.fetch({endpoint:"realm/".concat(e)}).then(function(t){return S.fetch({endpoint:"realm/".concat(t._id,"/voxels")}).then(function(e){return e=new Uint32Array(e),r(tt({size:t.size,voxels:e})),function(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},t=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){var t,r,n;t=o,n=i[r=e],r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n})}return o}({},t,{voxels:e})})})})}},reset:function(){return{type:b}},updateVoxels:function(e){var y=e.color,d=e.normal,v=e.point,b=e.remove;return function(e,t){var r=t().realm,n=r.size,o=r.voxels,i=et(["x","y","z"].map(function(e){for(var t=Math.floor(v[e]+.5*d[e]*(b?-1:1));t<0;)t+=n;for(;n<=t;)t-=n;return t}),3),a=i[0],s=i[1],c=i[2],u=Math.min(Math.max(Math.round(255*y.r+8*Math.random()-4),0),255),l=Math.min(Math.max(Math.round(255*y.g+8*Math.random()-4),0),255),f=Math.min(Math.max(Math.round(255*y.b+8*Math.random()-4),0),255),p=b?0:1<<24|u<<16|l<<8|f,h=new Uint32Array(o);return h[c*n*n+s*n+a]=p,e(tt({size:n,voxels:h})),e({type:m,payload:{voxels:h}})}}})(St);function _t(){return(_t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var jt=function(e){var n=e.renderer;return u.a.createElement(p.d,null,[{path:"/",Component:Ye},{path:"/:slug",Component:Et}].map(function(e){var t=e.path,r=e.Component;return u.a.createElement(p.b,{exact:!0,key:t,path:t,render:function(e){return u.a.createElement(r,_t({},e,{renderer:n}))}})}),u.a.createElement(p.a,{to:"/"}))};jt.propTypes={renderer:se.a.shape({current:se.a.instanceOf(ie)}).isRequired};var kt=jt;function Rt(e){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ct(e,t){return!t||"object"!==Rt(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function At(e){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tt,Dt,Lt,It,zt,Ut=L.a.div.withConfig({displayName:"layout__Wrapper",componentId:"d2i6t1-0"})(["width:100vw;height:100vh;"]),Ft={backgroundColor:"#393",zIndex:1},Bt=function(e){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=Ct(this,At(r).call(this,e))).renderer=u.a.createRef(),t}var t,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(r,i["PureComponent"]),t=r,(n=[{key:"render",value:function(){var e=this.renderer;return u.a.createElement("div",null,u.a.createElement(f.a,{style:Ft}),u.a.createElement(Ut,null,u.a.createElement(ie,{ref:e})),u.a.createElement(kt,{renderer:e}),u.a.createElement(N,null))}}])&&Pt(t.prototype,n),o&&Pt(t,o),r}(),qt=(window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__,a.d),Gt=Object(a.e)(D,{},qt(Object(a.a)(h.a,s.a,Object(l.loadingBarMiddleware)())));Tt=Gt,Dt=localStorage.getItem("REALMSVR::LOCALE"),Lt=((window.navigator.languages?window.navigator.languages[0]:null)||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage||k).substr(0,2).toLowerCase(),It=k,~j.indexOf(Dt)?It=Dt:~j.indexOf(Lt)&&(It=Lt),Object(y.syncTranslationWithStore)(Tt),Tt.dispatch(Object(y.loadTranslations)(R)),Tt.dispatch(Object(y.setLocale)(It)),Gt.getState().user.isAuth&&Gt.dispatch(zt?{type:g,payload:zt}:function(e){return e({type:"USER/REFRESH_SESSION",payload:S.fetch({endpoint:"user"})}).catch(function(){})});var Ht=Object(n.a)({basename:"/"});window.location.hash&&Ht.replace("/".concat(window.location.hash.substr(2))),window.addEventListener("contextmenu",function(e){return e.preventDefault()},!1);var Nt=document.getElementById("mount");Object(o.render)(u.a.createElement(c.Provider,{store:Gt},u.a.createElement(p.c,{history:Ht},u.a.createElement(Bt,null))),Nt)},f7Ve:function(e,t,r){e.exports=function(){return new Worker(r.p+"code/mesher.worker.cdf4d0fc1592aac67598.js")}},p2bk:function(e,t,r){}},[[0,1,2]]]);
//# sourceMappingURL=main.012f9f27dff3b4b4b546e3bfdd5895f6.js.map